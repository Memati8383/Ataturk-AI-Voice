<!DOCTYPE html>
<html lang="tr" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M.K. Atatürk - Cumhuriyetin Sesi</title>
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        gold: {
                            50: '#fdfbed',
                            100: '#f9f4d1',
                            200: '#f3e8a6',
                            300: '#ead271',
                            400: '#e1b743',
                            500: '#d4a01c',
                            600: '#b8860b',
                            700: '#94660d',
                            800: '#7a5210',
                            900: '#684513',
                        },
                        dark: {
                            950: '#0a0a0c',
                            900: '#0f0f12',
                            800: '#1a1a1f',
                            700: '#2a2a33',
                        }
                    },
                    fontFamily: {
                        cinzel: ['Cinzel', 'serif'],
                        sans: ['Plus Jakarta Sans', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer base {
            body {
                @apply bg-dark-950 text-slate-200 antialiased selection:bg-gold-500/30 selection:text-gold-200;
            }
        }
        @layer components {
            .glass {
                @apply bg-white/[0.02] border border-white/[0.05] backdrop-blur-xl;
            }
            .glass-hover {
                @apply hover:bg-white/[0.04] hover:border-white/[0.1] transition-all duration-300;
            }
            .btn-primary {
                @apply bg-gold-600 hover:bg-gold-500 text-dark-950 font-bold py-3 px-8 rounded-full 
                       transition-all duration-500 transform hover:scale-105 active:scale-95
                       shadow-[0_0_20px_rgba(184,134,11,0.3)] hover:shadow-[0_0_35px_rgba(184,134,11,0.5)];
            }
            .input-field {
                @apply bg-dark-900 border border-white/[0.08] rounded-3xl p-6 w-full focus:outline-none 
                       focus:border-gold-500/50 transition-all duration-300 text-lg leading-relaxed;
            }
            .nav-item {
                @apply flex items-center gap-2 px-4 py-2 rounded-full glass glass-hover cursor-default;
            }
            .status-dot {
                @apply w-2 h-2 rounded-full;
            }
            .slider-thumb {
                @apply appearance-none w-4 h-4 rounded-full bg-gold-500 cursor-pointer shadow-[0_0_10px_rgba(184,134,11,0.5)];
            }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col relative overflow-x-hidden">

    <!-- Decorative Gradients -->
    <div class="fixed top-[-10%] right-[-10%] w-[50%] h-[50%] bg-gold-600/10 blur-[120px] rounded-full -z-10 animate-pulse"></div>
    <div class="fixed bottom-[-10%] left-[-10%] w-[50%] h-[50%] bg-blue-600/5 blur-[120px] rounded-full -z-10"></div>

    <!-- Navigation -->
    <nav class="sticky top-0 z-50 px-6 py-4 border-b border-white/[0.05] glass">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-full border-2 border-gold-600 flex items-center justify-center p-1 overflow-hidden">
                    <img src="/assets/icon.png" alt="Logo" class="w-full h-full object-cover">
                </div>
                <h1 class="font-cinzel text-xl tracking-widest font-bold">M.K. <span class="text-gold-500">ATATÜRK</span></h1>
            </div>
            
            <div class="flex gap-4">
                <div class="nav-item">
                    <div id="rvcStatusDot" class="status-dot bg-slate-600"></div>
                    <span class="text-[10px] uppercase tracking-tighter font-bold opacity-70">RVC Sistemi</span>
                </div>
                <div class="nav-item">
                    <div id="ollamaStatusDot" class="status-dot bg-slate-600"></div>
                    <span class="text-[10px] uppercase tracking-tighter font-bold opacity-70">Ollama AI</span>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-1 w-full max-w-4xl mx-auto px-6 py-12 md:py-24 flex flex-col gap-16">
        
        <!-- Hero Section -->
        <section class="text-center flex flex-col items-center gap-6">
            <div class="inline-block px-4 py-1.5 rounded-full border border-gold-500/20 bg-gold-500/5 text-gold-400 text-xs font-bold tracking-[0.2em] uppercase mb-2">
                En Gelişmiş Yapay Zeka Teknolojisi
            </div>
            <h2 class="font-cinzel text-5xl md:text-7xl font-bold bg-gradient-to-b from-white to-white/40 bg-clip-text text-transparent leading-tight">
                Cumhuriyetin Sesi
            </h2>
            <p class="text-slate-400 text-lg md:text-xl font-light max-w-2xl leading-relaxed">
                Ulu önderimiz Mustafa Kemal Atatürk'ün sesini, modern RVC v2 teknolojisi ve 
                derin öğrenme modelleri ile dijital dünyaya taşıyoruz.
            </p>
        </section>

        <!-- Workspace -->
        <section class="w-full space-y-8">
            <div class="relative group">
                <div class="absolute -inset-1 bg-gradient-to-r from-gold-600/20 to-blue-600/10 rounded-[2.5rem] blur opacity-25 group-hover:opacity-40 transition duration-1000 group-hover:duration-200"></div>
                
                <div class="relative glass rounded-[2rem] p-4 md:p-8 space-y-6">
                    <textarea id="textInput" 
                        class="input-field min-h-[220px] placeholder:text-slate-600"
                        placeholder="Efendiler, bir metin giriniz... (Örn: Ey Türk Gençliği!)"></textarea>
                    
                    <!-- Progress Container -->
                    <div id="processContainer" class="hidden animate-in fade-in slide-in-from-bottom-4 duration-500">
                        <div class="p-6 bg-white/[0.02] border border-white/[0.05] rounded-3xl space-y-4">
                            <div class="flex justify-between text-[10px] font-bold uppercase tracking-widest text-slate-500">
                                <span>İşlem Süreci</span>
                                <span id="progressPercent">0%</span>
                            </div>
                            <div class="h-1.5 w-full bg-slate-800 rounded-full overflow-hidden">
                                <div id="progressBar" class="h-full bg-gold-500 w-0 transition-all duration-700 shadow-[0_0_15px_rgba(184,134,11,0.5)]"></div>
                            </div>
                            <div class="flex justify-between text-[10px] font-semibold text-slate-400">
                                <span id="step1" class="flex items-center gap-1.5"><div class="w-1.5 h-1.5 rounded-full bg-slate-700"></div> TTS</span>
                                <span id="step2" class="flex items-center gap-1.5"><div class="w-1.5 h-1.5 rounded-full bg-slate-700"></div> RVC v2</span>
                                <span id="step3" class="flex items-center gap-1.5"><div class="w-1.5 h-1.5 rounded-full bg-slate-700"></div> Hazır</span>
                            </div>
                        </div>
                    </div>

                    <!-- Voice Settings Panel -->
                    <div class="glass glass-hover rounded-3xl p-6 md:p-8 space-y-8">
                        <div class="flex items-center gap-3 text-gold-500">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"></path></svg>
                            <span class="font-bold text-xs uppercase tracking-widest">Akıllı Ses Parametreleri</span>
                        </div>
                        
                        <div class="grid md:grid-cols-3 gap-8 md:gap-12">
                            <!-- Pitch -->
                            <div class="space-y-4">
                                <div class="flex justify-between text-[11px] font-bold text-slate-500 uppercase tracking-tighter">
                                    <label>Ses Perdesi <span class="capitalize">(Pitch)</span></label>
                                    <span id="pitchVal" class="text-gold-500">0</span>
                                </div>
                                <input type="range" id="pitchInput" min="-12" max="12" step="1" value="0" 
                                    class="w-full h-1 bg-slate-800 rounded-lg appearance-none cursor-pointer accent-gold-500">
                                <div class="flex justify-between text-[9px] text-slate-600 font-bold uppercase tracking-widest">
                                    <span>Kalın</span>
                                    <span>İnce</span>
                                </div>
                            </div>

                            <!-- Index -->
                            <div class="space-y-4">
                                <div class="flex justify-between text-[11px] font-bold text-slate-500 uppercase tracking-tighter">
                                    <label>Benzerlik <span class="capitalize">(Index)</span></label>
                                    <span id="indexVal" class="text-gold-500">0.75</span>
                                </div>
                                <input type="range" id="indexInput" min="0" max="1" step="0.05" value="0.75" 
                                    class="w-full h-1 bg-slate-800 rounded-lg appearance-none cursor-pointer accent-gold-500">
                                <div class="flex justify-between text-[9px] text-slate-600 font-bold uppercase tracking-widest">
                                    <span>Standart</span>
                                    <span>Tam Uyum</span>
                                </div>
                            </div>

                            <!-- Protect -->
                            <div class="space-y-4">
                                <div class="flex justify-between text-[11px] font-bold text-slate-500 uppercase tracking-tighter">
                                    <label>Artifakt Koruma</label>
                                    <span id="protectVal" class="text-gold-500">0.33</span>
                                </div>
                                <input type="range" id="protectInput" min="0" max="0.5" step="0.01" value="0.33" 
                                    class="w-full h-1 bg-slate-800 rounded-lg appearance-none cursor-pointer accent-gold-500">
                                <div class="flex justify-between text-[9px] text-slate-600 font-bold uppercase tracking-widest">
                                    <span>Denge</span>
                                    <span>Pürüzsüz</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Footer Actions -->
                    <div class="flex flex-col md:flex-row justify-between items-center gap-6 pt-6 border-t border-white/[0.05]">
                        <div class="text-[10px] font-bold text-slate-500 uppercase tracking-widest flex items-center gap-2">
                             <div class="w-1.5 h-1.5 rounded-full bg-gold-600 animate-pulse"></div>
                             <span id="charCount">0 Karakter</span>
                        </div>
                        
                        <button id="generateBtn" onclick="generateSpeech()" class="btn-primary flex items-center gap-3">
                             <span id="btnText">Sesi Oluştur</span>
                             <div id="btnSpinner" class="hidden w-5 h-5 border-2 border-dark-950 border-t-transparent rounded-full animate-spin"></div>
                             <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Output Section -->
            <div id="outputSection" class="hidden animate-in zoom-in-95 duration-700">
                <div class="glass rounded-[2rem] p-8 md:p-12 text-center space-y-8 relative overflow-hidden">
                    <div class="absolute inset-0 bg-gold-500/5 -z-10"></div>
                    
                    <div class="space-y-4">
                        <h3 class="font-cinzel text-2xl font-bold text-gold-500">Ses Kaydı Hazırlandı</h3>
                        <p class="text-slate-500 text-sm">Üretilen sesi aşağıdan dinleyebilir veya indirebilirsiniz.</p>
                    </div>

                    <div class="w-full max-w-md mx-auto">
                        <audio id="audioPlayer" controls class="w-full h-12 rounded-full invert hue-rotate-180 brightness-150"></audio>
                    </div>

                    <div class="flex flex-wrap justify-center gap-4">
                        <a id="downloadLink" href="#" download="ataturk_ses.wav" 
                            class="px-8 py-3 rounded-full border border-gold-500/30 font-bold text-xs uppercase tracking-widest text-gold-500 hover:bg-gold-500 hover:text-dark-950 transition-all duration-300">
                            Dosyayı İndir
                        </a>
                    </div>
                </div>
            </div>
        </section>

        <!-- Signature Quote -->
        <footer class="text-center space-y-4 pt-12">
            <div class="h-px w-24 bg-gold-600/30 mx-auto"></div>
            <p class="font-cinzel text-xl text-gold-500/80 italic tracking-wide">
                “Hayatta en hakiki mürşit ilimdir, fendir.”
            </p>
            <p class="text-[10px] uppercase font-bold tracking-widest text-slate-600">
                © 2026 Atatürk AI Voice • Bilim ve Sanatın Işığında
            </p>
        </footer>
    </main>

    <script>
        // System Status Logic
        async function checkStatus() {
            try {
                const res = await fetch('/status');
                if(!res.ok) throw new Error();
                const status = await res.json();
                
                const rvcDot = document.getElementById('rvcStatusDot');
                const ollamaDot = document.getElementById('ollamaStatusDot');

                rvcDot.className = `status-dot ${status.rvc_ready ? 'bg-emerald-500 shadow-[0_0_10px_#10b981]' : 'bg-rose-500 shadow-[0_0_10px_#f43f5e]'}`;
                ollamaDot.className = `status-dot ${status.ollama_ready ? 'bg-emerald-500 shadow-[0_0_10px_#10b981]' : 'bg-rose-500 shadow-[0_0_10px_#f43f5e]'}`;
            } catch (e) {
                console.error("Status check failed");
            }
        }
        
        checkStatus();
        setInterval(checkStatus, 15000);

        // UI Interactions
        const textInput = document.getElementById('textInput');
        const charCount = document.getElementById('charCount');
        textInput.addEventListener('input', (e) => {
            charCount.textContent = `${e.target.value.length} Karakter`;
        });

        // Range Value Displays
        ['pitch', 'index', 'protect'].forEach(id => {
            const input = document.getElementById(id + 'Input');
            const val = document.getElementById(id + 'Val');
            input.addEventListener('input', () => val.textContent = input.value);
        });

        async function generateSpeech() {
            const generateBtn = document.getElementById('generateBtn');
            const btnText = document.getElementById('btnText');
            const btnSpinner = document.getElementById('btnSpinner');
            const outputSection = document.getElementById('outputSection');
            const audioPlayer = document.getElementById('audioPlayer');
            const downloadLink = document.getElementById('downloadLink');
            const progressBar = document.getElementById('progressBar');
            const progressPercent = document.getElementById('progressPercent');
            const processContainer = document.getElementById('processContainer');

            const text = textInput.value.trim();
            if (!text) {
                alert("Lütfen seslendirilmesini istediğiniz metni giriniz.");
                return;
            }

            // UI State: Active
            btnText.classList.add('hidden');
            btnSpinner.classList.remove('hidden');
            generateBtn.disabled = true;
            outputSection.classList.add('hidden');
            processContainer.classList.remove('hidden');
            
            // Progress Reset
            progressBar.style.width = '0%';
            progressPercent.textContent = '0%';
            ['step1', 'step2', 'step3'].forEach(id => {
                const el = document.getElementById(id);
                el.classList.remove('text-gold-500', 'text-emerald-500');
                el.querySelector('div').className = 'w-1.5 h-1.5 rounded-full bg-slate-700';
            });

            try {
                // Step 1: Initiated
                updateStep('step1', 'text-gold-500', 'bg-gold-500 shadow-[0_0_8px_#d4a01c]', '25%');
                
                const response = await fetch('/speak', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        text: text,
                        pitch: parseFloat(document.getElementById('pitchInput').value),
                        index_rate: parseFloat(document.getElementById('indexInput').value),
                        protect: parseFloat(document.getElementById('protectInput').value)
                    })
                });

                // Simulate TTS Finish -> RVC Start
                setTimeout(() => {
                    updateStep('step1', 'text-emerald-500', 'bg-emerald-500 shadow-[0_0_8px_#10b981]', '55%');
                    updateStep('step2', 'text-gold-500', 'bg-gold-500 shadow-[0_0_8px_#d4a01c]', '65%');
                }, 1200);

                const data = await response.json();

                if (response.ok) {
                    updateStep('step2', 'text-emerald-500', 'bg-emerald-500 shadow-[0_0_8px_#10b981]', '100%');
                    updateStep('step3', 'text-emerald-500', 'bg-emerald-500 shadow-[0_0_8px_#10b981]', '100%');

                    setTimeout(() => {
                        const audioUrl = data.audio_url + '?t=' + Date.now();
                        audioPlayer.src = audioUrl;
                        downloadLink.href = audioUrl;
                        
                        outputSection.classList.remove('hidden');
                        processContainer.classList.add('hidden');
                        audioPlayer.play();
                    }, 500);
                } else {
                    throw new Error(data.detail || "Sunucu hatası");
                }
            } catch (error) {
                alert(`Hata: ${error.message}`);
                processContainer.classList.add('hidden');
            } finally {
                btnText.classList.remove('hidden');
                btnSpinner.classList.add('hidden');
                generateBtn.disabled = false;
            }
        }

        function updateStep(id, textClass, dotClass, width) {
            const el = document.getElementById(id);
            const progressBar = document.getElementById('progressBar');
            const progressPercent = document.getElementById('progressPercent');

            el.className = `flex items-center gap-1.5 ${textClass} transition-colors duration-500`;
            el.querySelector('div').className = `w-1.5 h-1.5 rounded-full ${dotClass} transition-all duration-500`;
            progressBar.style.width = width;
            progressPercent.textContent = width;
        }
    </script>
</body>
</html>
